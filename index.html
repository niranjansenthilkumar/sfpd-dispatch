<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <link rel="stylesheet" href="node_modules/aos/dist/aos.css" />
    <script src="node_modules/aos/dist/aos.js"></script>
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <script src="node_modules/lodash/lodash.js"></script>
    <script src="lib/moment.js"></script>

    <link rel="stylesheet" type="text/css" href="styles/all.css" media="all" />

    <link href="https://fonts.googleapis.com/css?family=Muli:400,700" rel="stylesheet">


    <title>SFPD Dispatch</title>
  </head>
  <body>
    <script>
      AOS.init({
      offset: 200,
      duration: 600,
      easing: 'ease-in-sine',
      delay: 100,});
    </script>

    <script>
    d3.csv("/data/sfpd_dispatch_data_subset.csv", function(data) {
      console.log(data);

      var minLand = d3.extent(data, function(d) { return d.number_of_alarms; });
      console.log(minLand);

      var large_land = data.filter(function(d) { return d.station_area == 10; });
      console.log(large_land);



      var timedifferences = [];
      data.forEach(function(d) {
        var date1 = moment(d.entry_timestamp);
        var date2 = moment(d.received_timestamp);

        differenceInMs = date2.diff(date1); // diff yields milliseconds
        duration = moment.duration(differenceInMs); // moment.duration accepts ms
        differenceInMinutes = duration.asMinutes(); // if you would like to have the output 559
        differenceInSeconds = duration.asSeconds(); //seconds

        if (differenceInSeconds != 0){
          differenceInSeconds = differenceInSeconds * -1;

        }

        var date3 = moment(d.dispatch_timestamp);
        dispatchMs = date3.diff(date2);
        dispatchTime = moment.duration(dispatchMs);
        dispatchSeconds = dispatchTime.asSeconds();

        var total = differenceInSeconds + dispatchSeconds;

        timedifferences.push(total);
      });

      var medicalcount = 0;
      var alarmcount = 0;
      var firecount = 0;
      var hazardcount = 0;
      var trafficcount = 0;
      var othercount = 0;
      var other = [];
      data.forEach(function(d) {
        if(d.call_type == "Medical Incident"){
          medicalcount += 1;
        }
        else if(d.call_type == "Alarms"){
          alarmcount += 1;
        }
        else if(d.call_type == "Structure Fire" || d.call_type == "Outside Fire" || d.call_type == "Vehicle Fire"){
          firecount += 1;
        }
        else if(d.call_type == "Other" || d.call_type == "Citizen Assist / Service Call" || d.call_type == "Elevator / Escalator Rescue"){
          othercount += 1;
        }
        else if(d.call_type == "Traffic Collision"){
          trafficcount += 1;
        }
        else{
          hazardcount += 1;
        }
      });

      var call_type = [];
      call_type.push(medicalcount);
      call_type.push(alarmcount);
      call_type.push(firecount);
      call_type.push(trafficcount);
      call_type.push(hazardcount);
      call_type.push(othercount);

      console.log(timedifferences);
      console.log(call_type);

    });



    </script>

      <img data-aos="fade" id="sanfran" alt="San Francisco" src="images/sanfran.png" />
      <h1 data-aos="fade" data-aos-delay="700">
        Optimizing San Francisco's Emergency Dispatch to better predict emergency calls
      </h1>
      <div data-aos="fade" data-aos-delay="1400">
        <p>
          In 2017, San Francisco Firefighters and Paramedics responded to more than 135,000 calls for service across the San Francisco Region, a 15% increase from 2016. Moreover, at the cityâ€™s 911 call center, dispatchers handled 1.26 million emergency calls, a jump from 919,000 in 2007, paralleling a swell in the city's population.
        </p>

        <p>
          However, a problem still plagues the dispatch system in San Francisco: <strong>increasingly long dispatch times for emergency services.</strong>
        </p>

        <p>
          The San Francisco Fire Department has increasingly struggled to get dispatch services to emergencies within the region, an issue that has been detailed in city reports for several years. Last August, there were more than 374 incidents where it took more than 20 minutes for an ambulance to arrive at a call - including nine cases where it took more than an hour.
        </p>

        <p>
          Dispatch call center response times also showed a similar pattern. Only about 79 percent of the 1.26 million emergency calls received in 2017 were answered within the national 10-second standard. Nonemergency calls trended lower, with an average of 57 percent of calls answered within the recommended one-minute mark.
        </p>
      </div>

  </body>
</html>
